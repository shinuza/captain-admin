<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>CaptainJS - Create user</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>

<div id="overlay">
  <form id="user-form">
    <h1>Create user</h1>
    <div class="fields">
      <p>
        <label for="username">Username:</label>
        <input type="text" name="username" id="username">
      </p>
      <p>
        <label for="password">Password:</label>
          <input type="password" name="password" id="password">
          <input type="checkbox" id="show_password"><label for="show_password"><small>Show password</small></label>
      </p>
    </div>
    <input id="submit" type="submit" class="button">
  </form>
</div>

<script src="js/lib/underscore.js"></script>
<script src="js/lib/zepto.js"></script>
<script src="js/lib/zepto.extra.js"></script>
<script src="js/lib/swig.js"></script>
<script src="js/lib/backbone.js"></script>

<script src="js/src/app.js"></script>
<script src="js/src/views/overlay_view.js"></script>
<script>
  $(function() {
    App.overlay = new App.Overlay;
    App.overlay.show();

    var username = $('#username');
    var password = $('#password');
    var show_password = $('#show_password');

    show_password.click(function() {
      var type = password.attr('type');
      password.attr('type', type == 'password' ? 'text' : 'password');
    });

    $('#user-form').submit(function() {
      var data = {
        username: username.val(),
        password: password.val()
      };

      $.postJSON('/create_user', JSON.stringify(data), function() {
        alert('User created, you can now log in');
        document.location.assign(document.location.href.replace('create_user', ''));
      }, function(xhr, type){
        alert('Creation failed');
        username.focus();
      });
      return false;
    });
  });
</script>
</body>
</html>
